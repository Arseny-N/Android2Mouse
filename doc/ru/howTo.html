<!doctype html>
<html lang="ru">


	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Android2Mouse</title>
				<link rel="stylesheet" href="../css/app.css" />
		<!--<script src="bower_components/modernizr/modernizr.js"></script>-->
	</head>

	<script src="http://code.jquery.com/jquery-1.9.1.js"></script>	
	
<body>
	<nav class="top-bar" data-topbar> 
		<ul class="title-area"> 
			<li class="name"> 
				<h1><a href="index.html">Android2Mouse</a></h1> 
			</li> 

		</ul> 
		<section class="top-bar-section"> 
			<!-- Left Nav Section --> 
			<ul class="left"> 
				<li><a href="howTo.html">How-To</a></li>
				<li><a href="about.html">Resources</a></li>
			 </ul>
		</section>
	</nav>
	
<section role="main">
		<div class="row">
		
		
			<div class="small-3 columns">
				<div class="hide-for-small">
					<div class="magellan-container" >


				        <div class="sidebar">				        	
						<nav>
						    <ul class="my-side-nav">
		<li><a href="#what-you-need">What you will need.</a></li>
		<li><a href="#how-to-root">How to root.</a></li>
		<li><a href="#how-to-install">How to install it.</a></li>
		<li><a href="#how-to-run">How to run it.</a></li>
		<li><a href="#in-case">In case it do not work.</a></li>
		<li><a href="#how-does-it-work">How does it work.</a></li>
						    </ul>
						</nav>
		        		</div>
		        		</div>
		        		  <script src="js/jquery.js"></script>
  <script src="js/foundation/foundation.js"></script>
  <script src="js/foundation/foundation.magellan.js"></script>
        			</div>
			</div> 
			<div class="small-9  columns end">



	<h1>Android2Mouse</h1>
	<p><b> This tutorial explains how to setup the "Android2Mouse" on your Android phone</b>

	<h2 id="what-you-need">What you will need.</h2>
	<p>
		<ul>
			<li>A rooted phone running Android with bluetooth support.</li>
			<li>A PC with bluetooth support (hidp).</li>
			<li>The "Android2Mouse" package.</li>
			<li>A usb cable.</li>
			<li>Patience.</li>
		</ul>
	</p>
	<h2 id="how-to-root"> How to root your phone.</h2>
	<p>
		A good superuser permission manager (which I use) is <a href="https://play.google.com/store/apps/details?id=eu.chainfire.supersu"> SuperSu</a> someone prefers  <a href="https://github.com/koush/Superuser">koush's Superuser</a>. 
		Well it is not completely free but it's "unrated" part is suitable for our purpose, we will not go in further details about rooting here.
	</p>
	<h2 id="how-to-install"> How to install <b>Android2Mouse</b>.</h2>
	<p>
		There is no cross-platform method of installing the <b>Android2Mouse</b> package.
		<h3>Windows</h3>
		<p>
			<ul>
			<li> Root your phone.</li>
			<li> Download the Android2Mouse package <a href="https://github.com/Arseny-N/Android2Mouse">here</a></li>
			<li> Run the <code> install.bat</code> </li>
			</ul>
			If it fails with the error "device not found" check if all the needed drivers are properly installed.
		</p>
		<h3>*nix folks</h3>
		<p>
			<ul>
			<li> Root your phone.</li>
			<li> Download the Android2Mouse package <a href="https://github.com/Arseny-N/Android2Mouse">here</a></li>
			<li> Install the <code> adb </code> program. (<code> sudo yum install adb </code> or with <code>sudo apt-get install adb</code>)</li>
			<li> Double click the <code> install.sh</code> </li>
			
			</ul>
		</p>
	</p>
	<h2 id="how-to-run"> How to run the suite.</h2>
	<p>
		 If everything is fine you should have now two new apps - "Become A Mouse" and "Bluetooth Mouse"<br>
		To make everything work do the following: 
		<ul>
		<li>Turn on the Bluetooth.</li>
		<li>Run the "became a mouse" app (grant it superuser permissions) push the "become a mouse button". Now your phone will be seen as a Bluetooth mouse buy all the other devices. You can close the app.
		</li>
		<li>
		Start a search of devices and pair your phone with the target one.<b> Warning, do it from your phone, doing otherwise may result in failures.</b>
		
		</li>
		<li>
		Run the "Bluetooth Mouse" app, find the target device in the list and tap on it, if you don't find it there then you are not properly paired.
		</li>
		<li>
		Congratulations! Now you can use your phone screen as a touch-pad.
		</li>
		</ul>
		
	</p>
	<h2 id="in-case"> In case it do not work.</h2>
	<p>
		Well, to be honest Bluetooth it's sometimes a <b>little</b> bit buggy, so if everything works from the first time you are rather lucky.<br>
		If not, the possible sources of failures are:
<ul>
		<li>No root privileges.</li>
		<p>
			Run a terminal app on your device and tap there <code>su -c id</code> if the output is something like <code>uid=0(root) gid=0(root)</code> you are rooted. That's not the cause.
		</p>
		<li>Cached Bluetooth credentials.</li>
		<p>
			
			
			Remove the pair on both devices and pair them again. Before pairing them close the bluetooth applet on the phone and switch the bluetooth on and off on the host machine.
						
			In case of *nix a <code>sudo rm -rf /lib/var/bluetooth </code>
			may help, if you do so you remove all the <code>bluetoothd</code> cache
			so after doing this you will lose all the paired devices(not a big waste),then restart the daemon <code> systemctrl restart blurtoothd </code> , but leave this for extreme cases.
			
			This happens because the computer caches the information about your phone and don't notice that the phone has become a mouse.
			
			
		</p>
		<li>Not that elf.</li>
		<p>
		Run the <code>/data/bmouse</code>. Normally it will output a usage message but if the executable refuses to run giving wired elf errors then out arhces don't match (quite unprababble), try to recompile it, to do this <a href="http://thetechcaptain.blogspot.ru/2012/08/how-to-cross-compile-c-code-for-android.html">install the cross-compiling tool-chain</a> (should be a debian/ubuntu folk, fedora don't support arm-gcc fully, it supports it with no Glibc so it is only useful for compiling kernels). Add the needed CFLAGS in the Makefile and from the root dir of the project run <code>make BuildBin</code> then <code>make InstallBin</code>.
		</p>
		<li>If you are hardcore.</li>
		<p>
			Nothing works and you <b>need</b> that app to work try to run <code> adb shell</code> [<a href=..>more</a>]
			then run <code> cat /data/hidp_clientd.log</code>. What is outputed? If the error is "Host is down" than try the upper-mentioned method of cached Bluetooth creds.
			
		</p>
		</ul>

	</p>
	<h2 id="how-does-it-work"> How does it work.</h2>
	<p>
		If you are even more hardcore and want to figure out how the program accomplish it's task then read further.<br>
		The program could be broken in three main parts: the <code> hidp_clientd</code> or daemon, the <code> bmouse</code> or attribute changer and the gui.
		<h3>The daemon.</h3>
		<p>
			Its main task is to establish a l2cap connection with psm equal 0x11 and 0x13, read data from the command fifo(<code>/data/hidp_clientd.fifo</code>), interpret it and send via the l2cap sockets, this is done as written in the <a href="https://developer.bluetooth.org/TechnologyOverview/Pages/HID.aspx">hidp spec</a>.However not all the spec is implemented - it drops packets received from the host because I never receved one, so I considered it a waste of time to implement this. Sometimes it bizarrely hangs, so when you quit the giu a <code>pkill hidp_clientd</code> is triggered.
		</p>
		<h3>The attribute changer.</h3>
		Its main task is to add an sdp record and change the CoD of the device [<a href="https://developer.bluetooth.org/TechnologyOverview/Pages/HID.aspx">more</a>].
		<div class="pointer"><i>The Bluetooth stack is the most undocumented thing I ever come through .So in case you are in the process of figuring out something a good place for doing this is the <code>bluez</code> package, if more precisely the <code>tools/</code> directory. The sdp_lib.h api is well shown in the sdp tool,the hci_lib api in the hcitool and so on.</i></div>
		<h3>The GUI.</h3>
		<p>
		It's main task is to list all the paired devices available on the phone, get the address of the one chosen by the user, send it to the daemon and interpret gestures via the <a href="https://developer.android.com/reference/android/view/GestureDetector.html">GestueDetector</a> lib sending them to the daemon via a <a href="..">JNI library</a> specially written for this purpose.
		</p>
		
		
		</div>

		<div class="row">
	<div class="small-9 small-centered columns">
		<a href="index.html" class="button"> prev </a>
		<a href="about.html" class="button"> next </a>
	</div>
</div>

</body>
</html>
